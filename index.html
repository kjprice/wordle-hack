<!-- TODO:
    - Create UI for various inputs and a submit button
    - Display list of possible words
 -->

 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <title>Wordle Hack</title>
    <script>
        let wordsList;
        const ESCAPE_CHARS = new Set([' ', '_']);

        function loadWords() {
            return new Promise((res, rej) => {
                var client = new XMLHttpRequest();
                const wordsUrl = `${window.location.href}words.txt`
                client.open('GET', wordsUrl);
                client.onreadystatechange = function() {
                    if (client.status != 200) {
                        rej(client.responseText);
                        return;
                    }
                    if (client.readyState == 4) {
                        res(client.responseText);
                    }
                }
                client.send();
            });
        }

        function setWords(words) {
            wordsList = words.split('\n');
            console.log(`Found ${wordsList.length} words`);
            return wordsList;
        }
        function setupForm() {
            document.querySelector('#words_form').style.display = 'block';
            document.querySelector('#words_form').onsubmit = findWords;

            // TODO: DELETE
            findWords();
        }

        window.onload = () => {
            loadWords().then(setWords).then(setupForm);
        }

        function wordContainsAnyLetters(word, letters) {
            for (const letter of letters) {
                if (word.includes(letter)) {
                    return true;
                }
            }

            return false;
        }

        function findWords(e) {
            if (e) {
                e.preventDefault();
            }
            const exactLetters = document.querySelector('#exact_letters').value;

            if (exactLetters.length != 5) {
                showError(`Expected exactly five letters but found "${exactLetters}" (${exactLetters.length} total letters)`);
                return;
            }

            let goodWords = [...wordsList]; // Make a copy

            // Continuously filter out words, matching letter by letter
            const wordLetters = exactLetters.toLowerCase().split('');
            wordLetters.forEach((letter, i) => {
                if (ESCAPE_CHARS.has(letter)) {
                    return;
                }

                goodWords = goodWords.filter(goodWord => goodWord[i] === letter);
            });

            const knownLetters = document.querySelector('#known_letters').value;
            const ignoreLetters = document.querySelector('#ignore_letters').value;

            // Words must include these letters
            if (knownLetters.length > 0) {
                goodWords = goodWords.filter(word => wordContainsAnyLetters(word, knownLetters));
            }

            // Words must not include these letters
            if (ignoreLetters.length > 0) {
                goodWords = goodWords.filter(word => !wordContainsAnyLetters(word, ignoreLetters));
            }

            displayWordsList(goodWords);
        }

        function displayWordsList(words) {
            setResponse(createWordsHtmlList(words));
        }

        function createWordsHtmlList(words) {
            return [
                '<ul>',
                words.map(word => `<li>${word}</li>`).join('\n'),
                '</ul>'
            ].join('\n');
        }

        function showError(errorText) {
            setResponse('<div style="color: red">' + errorText + '</div>');
        }

        function setResponse(responseHtml) {
            document.querySelector('#response').innerHTML = responseHtml;
        }
    </script>
</head>
<body>
    <div class="container-fluid">
        <h1>Hack Wordle!</h1>

        <p>If you ever get stuck playing wordle, use this easy tool to help you out.</p>
        <p>First, if you haven't yet provided any letters to wordle, use the following three words to quickly narrow down available letters:</p>
        <ul>
            <li>party</li>
            <li>cloud</li>
            <li>singe</li>
        </ul>

        <p>These words above include all vowels and most common consonants.</p>
        <p>After you have a list of available letters, use the form below to cheat the game by automatically filtering through a list of five-letter words.</p>

        <form id="words_form" style="display: none;">
            <div><label>Letters Positions*: <input type="text" id="exact_letters" value="pa_ty" /></label></div>
            <div>
                *Note: Provide space or underscore for unkown letters
            </div>
            <br/>
            <div><label>Other Letters: <input type="text" id="known_letters" value="r" /></label></div>
            <div><label>Ignored Letters: <input type="text" id="ignore_letters" /></label></div>
            <div><button type="submit">Submit</button></div>
        </form>
        <div id="response"></div>
    </div>
</body>
</html>